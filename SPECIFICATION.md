# フラッシュカードアプリ 仕様書

## 1. 概要

### 1.1 アプリケーション名
**GAS フラッシュカード**

### 1.2 目的
Google Apps Script (GAS) と HTML を活用した、英単語学習用のフラッシュカードアプリケーション。
Anki風の間隔反復学習システムを採用し、効率的な暗記学習をサポートする。

### 1.3 技術スタック
| 項目 | 技術 |
|------|------|
| バックエンド | Google Apps Script (GAS) |
| フロントエンド | HTML / CSS / JavaScript |
| データベース | Google スプレッドシート |
| 音声合成 | Web Speech API |

### 1.4 利用者
- 個人利用（共有機能なし）

---

## 2. システム構成

### 2.1 ファイル構成
```
📁 HTML_GAS_flashcards
  ├── Code.gs          # GASメインコード（サーバーサイド処理）
  ├── Index.html       # メイン画面（HTML構造）
  ├── Style.html       # スタイルシート（CSS）
  ├── Script.html      # クライアントサイドJavaScript
  ├── SPECIFICATION.md # 本仕様書
  └── README.md        # セットアップ手順
```

### 2.2 スプレッドシート構成

#### シート1: Cards（カードデータ）
カードのデータと表示設定を管理するメインシート。

**構造：**
```
|   | A | B | C | D | E | F | G |
|---|---|---|---|---|---|---|---|
| 1 | フィールド名 | ID | デッキ | 英語 | 日本語 | 読み | 例文 | 発音記号 |
| 2 | 表示面 | - | - | 表 | 裏 | 裏 | 裏 | 非表示 |
| 3 | 表示順 | - | - | 1 | 1 | 2 | 3 | - |
| 4 | 読上順 | - | - | 1 | 2 | - | - | - |
| 5 | （データ開始） | 1 | TOEIC/基礎 | apple | りんご | アップル | I eat an apple. | ˈæp.əl |
| 6 | | 2 | TOEIC/基礎 | book | 本 | ブック | This is a book. | bʊk |
```

**行の説明：**
| 行番号 | 内容 | 説明 |
|--------|------|------|
| 1行目 | フィールド名 | 各列のデータ項目名（ヘッダー） |
| 2行目 | 表示面 | 「表」「裏」「非表示」のいずれか |
| 3行目 | 表示順 | 表面・裏面それぞれでの表示順序（数字） |
| 4行目 | 読上順 | 読み上げの順序（数字、空欄は読み上げなし） |
| 5行目〜 | カードデータ | 実際のフラッシュカードデータ |

**固定列（A〜B列）：**
| 列 | フィールド名 | 説明 |
|----|-------------|------|
| A | ID | カードの一意識別子（自動採番、スプレッドシートの行番号） |
| B | デッキ | カードが属するデッキ（パス形式で階層表現） |

**動的列（C列以降）：**
ユーザーが自由に追加・編集可能。初期フィールド：
| 列 | フィールド名 | 説明 | 例 |
|----|-------------|------|-----|
| C | 英語 | 英単語 | apple |
| D | 日本語 | 日本語訳 | りんご |
| E | 読み | カタカナ読み | アップル |
| F | 例文 | 例文 | I eat an apple. |
| G | 発音記号 | 発音記号 | ˈæp.əl |

#### シート2: Progress（学習進捗）
各カードの学習状況を記録するシート。

**構造：**
```
|   | A | B | C | D | E | F | G |
|---|---|---|---|---|---|---|---|
| 1 | 行番号 | 正解数 | 不正解数 | 連続正解 | 次回復習日 | お気に入り | 合格 |
| 2 | 5 | 3 | 1 | 2 | 2025-12-01 | FALSE | FALSE |
| 3 | 6 | 5 | 0 | 5 | 2025-12-05 | TRUE | TRUE |
```

**列の説明：**
| 列 | フィールド名 | データ型 | 説明 |
|----|-------------|---------|------|
| A | 行番号 | 数値 | Cardsシートの行番号（5行目〜に対応） |
| B | 正解数 | 数値 | 累計正解回数 |
| C | 不正解数 | 数値 | 累計不正解回数 |
| D | 連続正解 | 数値 | 現在の連続正解数 |
| E | 次回復習日 | 日付 | 次に復習すべき日付 |
| F | お気に入り | 真偽値 | TRUE / FALSE |
| G | 合格 | 真偽値 | TRUE / FALSE（ユーザーが手動で設定） |

#### シート3: Settings（アプリ設定）
アプリ全体の設定を保存するシート。

**構造：**
```
|   | A | B | C |
|---|---|---|---|
| 1 | 設定キー | 設定値 | 説明 |
| 2 | speechRateEn | 1.0 | 英語読み上げ速度 (0.5〜2.0) |
| 3 | speechRateJa | 1.0 | 日本語読み上げ速度 (0.5〜2.0) |
| 4 | waitTimeBetweenCards | 3 | カード間の待機時間（秒） |
| 5 | waitTimeAfterFlip | 2 | めくり後の待機時間（秒） |
| 6 | autoFlip | TRUE | 読み上げ後に自動でめくるか |
| 7 | repeatMode | FALSE | リピート再生モード |
| 8 | interval_1 | 1 | 1回目正解後の復習間隔（日） |
| 9 | interval_2 | 3 | 2回連続正解後の復習間隔（日） |
| 10 | interval_3 | 7 | 3回連続正解後の復習間隔（日） |
| 11 | interval_4 | 14 | 4回連続正解後の復習間隔（日） |
| 12 | interval_5 | 30 | 5回以上連続正解後の復習間隔（日） |
```

---

## 3. 機能仕様

### 3.1 デッキ管理

#### 3.1.1 ツリー形式のデッキ構造
- デッキは階層構造（ツリー形式）で管理
- 階層数は**無制限**
- パス形式で表現（例：`TOEIC/基礎/レベル1`）
- 区切り文字は `/`（スラッシュ）

**デッキ構造例：**
```
📁 TOEIC
  ├── 📁 基礎
  │   ├── 📁 レベル1
  │   └── 📁 レベル2
  └── 📁 上級
📁 英検
  ├── 📁 2級
  └── 📁 準1級
📁 日常会話
```

**スプレッドシートでの表現：**
| デッキ列の値 | 階層 |
|-------------|------|
| `TOEIC` | 1階層目 |
| `TOEIC/基礎` | 2階層目 |
| `TOEIC/基礎/レベル1` | 3階層目 |

#### 3.1.2 デッキ選択機能
- サイドバーにツリー形式でデッキ一覧を表示
- 親デッキを選択すると、その配下の全カードが対象になる
- 複数デッキの同時選択が可能

### 3.2 フィールド管理

#### 3.2.1 動的フィールド
- フィールド（列）は**スプレッドシートで直接追加・編集**
- アプリは起動時にCardsシートの1行目を読み取り、フィールドを動的に認識
- フィールド数に**制限なし**

#### 3.2.2 表示設定
各フィールドに対して以下を設定可能：

| 設定項目 | 設定値 | 説明 |
|---------|-------|------|
| 表示面（2行目） | `表` | カードの表面に表示 |
| | `裏` | カードの裏面に表示 |
| | `非表示` または 空欄 | 表示しない |
| 表示順（3行目） | 数字 | 表示する順番（1が最初） |
| 読上順（4行目） | 数字 | 読み上げる順番（空欄は読み上げない） |

### 3.3 カード表示

#### 3.3.1 フラッシュカード画面
```
┌─────────────────────────────────────┐
│                                     │
│            【表面】                  │
│                                     │
│            apple                    │
│                                     │
│                                     │
│         [タップでめくる]             │
│                                     │
└─────────────────────────────────────┘
          ↓ タップ後 ↓
┌─────────────────────────────────────┐
│                                     │
│            【裏面】                  │
│                                     │
│           りんご                    │
│          アップル                   │
│      I eat an apple.               │
│                                     │
│   [不正解 ✗]           [正解 ○]    │
│                                     │
└─────────────────────────────────────┘
```

#### 3.3.2 表示順序
- 表面・裏面それぞれで、3行目（表示順）の数字順に表示
- 同じ数字の場合は列順（左から右）

### 3.4 読み上げ機能

#### 3.4.1 単体読み上げ
- 各フィールドに読み上げボタンを配置
- Web Speech API を使用
- 英語フィールドは英語音声、日本語フィールドは日本語音声で自動判別

#### 3.4.2 連続読み上げ
- 4行目（読上順）に従って順番に読み上げ
- 読み上げ完了後、設定した待機時間を経て次のカードへ

**連続読み上げフロー例：**
```
1. カード表示（表面）
2. 英語を読み上げ（読上順1）
3. 自動で裏面にめくる（autoFlip=TRUE の場合）
4. 日本語を読み上げ（読上順2）
5. 待機時間（waitTimeBetweenCards秒）
6. 次のカードへ
7. リピートモードの場合は1に戻る
```

#### 3.4.3 読み上げ設定
| 設定項目 | 範囲 | デフォルト |
|---------|------|-----------|
| 英語読み上げ速度 | 0.5〜2.0 | 1.0 |
| 日本語読み上げ速度 | 0.5〜2.0 | 1.0 |
| カード間待機時間 | 0〜10秒 | 3秒 |
| めくり後待機時間 | 0〜10秒 | 2秒 |
| 自動めくり | ON/OFF | ON |
| リピート再生 | ON/OFF | OFF |

### 3.5 学習モード

#### 3.5.1 モード一覧
| モード | 説明 |
|--------|------|
| 今日の復習 | 次回復習日が今日以前のカードのみ |
| 新規学習 | まだ一度も学習していないカード |
| 全体復習 | 選択したデッキの全カード |
| 範囲指定 | 行番号の範囲を指定して学習 |

#### 3.5.2 絞り込み機能
以下の条件で絞り込みが可能（組み合わせ可）：

| 絞り込み条件 | 設定例 |
|-------------|-------|
| 行番号範囲 | 5〜25（5行目から25行目まで） |
| 合格状態 | 未合格のみ / 合格済のみ / すべて |
| お気に入り | お気に入りのみ / すべて |
| デッキ | 特定のデッキを選択 |

**絞り込み例：**
- 「行番号 5〜25 かつ 未合格」
- 「行番号 5〜55 かつ お気に入り」
- 「TOEIC/基礎 かつ 未合格」

#### 3.5.3 カードシャッフル
- 学習開始時にカードの順序をランダム化
- ON/OFF 切り替え可能

### 3.6 間隔反復学習（Anki風）

#### 3.6.1 復習間隔の仕組み
| 連続正解数 | 次回復習までの日数 |
|-----------|-------------------|
| 0回（不正解時） | 当日（すぐに再出題） |
| 1回 | 1日後 |
| 2回 | 3日後 |
| 3回 | 7日後 |
| 4回 | 14日後 |
| 5回以上 | 30日後 |

#### 3.6.2 間隔設定
- Settingsシートで復習間隔を一括カスタマイズ可能
- 設定画面からも変更可能

### 3.7 進捗管理

#### 3.7.1 カード別進捗
各カードに対して以下を記録：
- 正解数
- 不正解数
- 連続正解数
- 次回復習日
- お気に入りフラグ
- 合格フラグ

#### 3.7.2 統計表示
| 統計項目 | 説明 |
|---------|------|
| 今日の学習数 | 今日学習したカードの枚数 |
| 学習済み / 全体 | 一度でも学習したカード数 / 総カード数 |
| 合格数 | 合格マークを付けたカード数 |
| 正解率 | 全体の正解率（%） |
| 復習待ちカード | 今日復習すべきカードの枚数 |

#### 3.7.3 進捗グラフ
- 日別の学習数グラフ
- 正解率の推移グラフ

### 3.8 お気に入り・合格機能

#### 3.8.1 お気に入り
- カード表示中に ★ ボタンでお気に入り登録/解除
- 絞り込みで「お気に入りのみ」表示可能

#### 3.8.2 合格マーク
- カードを十分に覚えたと判断したら手動で「合格」マーク
- 合格したカードは復習対象から除外可能
- 「未合格」の定義：合格マークが付いていないカード

---

## 4. 画面仕様

### 4.1 画面一覧
| 画面名 | 説明 |
|--------|------|
| ホーム | 統計サマリー、学習開始ボタン |
| デッキ選択 | ツリー形式でデッキを選択 |
| 学習設定 | モード・絞り込み・シャッフル設定 |
| 学習画面 | フラッシュカード表示・回答 |
| 設定画面 | アプリ全体の設定 |
| 統計画面 | 詳細な学習統計 |

### 4.2 画面遷移
```
[ホーム]
    │
    ├── [デッキ選択] → [学習設定] → [学習画面] → [結果画面] → [ホーム]
    │
    ├── [設定画面]
    │
    └── [統計画面]
```

### 4.3 レスポンシブ対応
- PC・タブレット・スマートフォンに対応
- タッチ操作に最適化

---

## 5. データ仕様

### 5.1 カードID
- スプレッドシートの**行番号**をIDとして使用
- 5行目のカードは ID = 5
- カードの追加・削除で行番号が変わるため、Progressシートとの整合性に注意

### 5.2 デッキパスの形式
```
デッキ名1/デッキ名2/デッキ名3
```
- `/` で階層を区切る
- デッキ名に `/` は使用不可

### 5.3 日付形式
- `YYYY-MM-DD` 形式（例：2025-11-28）

---

## 6. 設定項目一覧

### 6.1 表示設定
| 設定キー | 型 | デフォルト | 説明 |
|---------|---|-----------|------|
| theme | 文字列 | light | テーマ（light/dark） |

### 6.2 読み上げ設定
| 設定キー | 型 | デフォルト | 説明 |
|---------|---|-----------|------|
| speechRateEn | 数値 | 1.0 | 英語読み上げ速度 |
| speechRateJa | 数値 | 1.0 | 日本語読み上げ速度 |
| autoFlip | 真偽値 | true | 読み上げ後自動めくり |
| waitTimeAfterFlip | 数値 | 2 | めくり後待機時間（秒） |
| waitTimeBetweenCards | 数値 | 3 | カード間待機時間（秒） |
| repeatMode | 真偽値 | false | リピート再生 |

### 6.3 学習設定
| 設定キー | 型 | デフォルト | 説明 |
|---------|---|-----------|------|
| shuffleCards | 真偽値 | true | カードシャッフル |
| showProgress | 真偽値 | true | 進捗表示 |

### 6.4 間隔反復設定
| 設定キー | 型 | デフォルト | 説明 |
|---------|---|-----------|------|
| interval_1 | 数値 | 1 | 1回正解後の間隔（日） |
| interval_2 | 数値 | 3 | 2回連続正解後の間隔 |
| interval_3 | 数値 | 7 | 3回連続正解後の間隔 |
| interval_4 | 数値 | 14 | 4回連続正解後の間隔 |
| interval_5 | 数値 | 30 | 5回以上連続正解後の間隔 |

---

## 7. API仕様（GAS関数）

### 7.1 データ取得
| 関数名 | 引数 | 戻り値 | 説明 |
|--------|------|--------|------|
| getCards() | なし | Array | 全カードデータ取得 |
| getCardsByDeck(deckPath) | デッキパス | Array | デッキ内カード取得 |
| getProgress() | なし | Object | 全進捗データ取得 |
| getSettings() | なし | Object | 設定取得 |
| getDecks() | なし | Array | デッキ一覧取得（ツリー構造） |
| getFields() | なし | Array | フィールド定義取得 |

### 7.2 データ更新
| 関数名 | 引数 | 戻り値 | 説明 |
|--------|------|--------|------|
| updateProgress(rowNum, data) | 行番号, 進捗データ | Boolean | 進捗更新 |
| updateSettings(settings) | 設定オブジェクト | Boolean | 設定更新 |
| toggleFavorite(rowNum) | 行番号 | Boolean | お気に入り切替 |
| togglePassed(rowNum) | 行番号 | Boolean | 合格切替 |
| recordAnswer(rowNum, isCorrect) | 行番号, 正解フラグ | Object | 回答記録 |

---

## 8. 初期データ

### 8.1 初期フィールド（Cardsシート）
| 列 | A | B | C | D | E | F | G |
|----|---|---|---|---|---|---|---|
| 1行目 | ID | デッキ | 英語 | 日本語 | 読み | 例文 | 発音記号 |
| 2行目 | - | - | 表 | 裏 | 裏 | 裏 | 非表示 |
| 3行目 | - | - | 1 | 1 | 2 | 3 | - |
| 4行目 | - | - | 1 | 2 | - | - | - |

### 8.2 サンプルカード
| ID | デッキ | 英語 | 日本語 | 読み | 例文 | 発音記号 |
|----|--------|------|--------|------|------|----------|
| 5 | サンプル | apple | りんご | アップル | I eat an apple every day. | ˈæp.əl |
| 6 | サンプル | book | 本 | ブック | This is a book. | bʊk |
| 7 | サンプル | cat | 猫 | キャット | The cat is sleeping. | kæt |

---

## 9. セットアップ手順

### 9.1 事前準備
1. Googleアカウントにログイン
2. Google ドライブにアクセス

### 9.2 スプレッドシート作成
1. 新規スプレッドシートを作成
2. スプレッドシートのIDをメモ（URLの `/d/` と `/edit` の間の文字列）

### 9.3 GASプロジェクト作成
1. スプレッドシートのメニュー「拡張機能」→「Apps Script」
2. 本プロジェクトのファイルをコピー
3. `Code.gs` の `SPREADSHEET_ID` を自分のスプレッドシートIDに変更

### 9.4 デプロイ
1. 「デプロイ」→「新しいデプロイ」
2. 種類を「ウェブアプリ」に設定
3. 「自分」として実行、「自分のみ」がアクセス可能に設定
4. デプロイしてURLを取得

---

## 10. 更新履歴

| バージョン | 日付 | 内容 |
|-----------|------|------|
| 1.0.0 | 2025-11-28 | 初版作成 |

---

## 11. 補足事項

### 11.1 制限事項
- カードの追加・編集はスプレッドシートで直接行う
- アプリ内からのカード編集機能は未実装
- 画像の表示は未対応

### 11.2 今後の拡張予定
- 画像フィールド対応
- アプリ内カード編集機能
- エクスポート/インポート機能
- 複数ユーザー対応

---

*本仕様書は開発の基準となるドキュメントです。変更がある場合は本仕様書を更新してください。*
