# 開発ステップ計画

## 概要
GAS フラッシュカードアプリの開発ステップと進捗状況を管理するドキュメントです。

---

## 開発進捗サマリー

| ステップ | 内容 | 状態 | 完了日 |
|:--------:|------|:----:|:------:|
| 1 | 基本構造 + スプレッドシート接続 | ✅ | 2025-11-28 |
| 2 | カードデータ表示（表/裏めくり） | ✅ | 2025-11-28 |
| 3 | デッキ管理（ツリー表示・選択） | ✅ | 2025-11-28 |
| 4 | 学習モード・絞り込み機能 | ✅ | 2025-11-28 |
| 5 | 正解/不正解記録・進捗管理 | ✅ | 2025-11-28 |
| 6 | 読み上げ機能 | ✅ | 2025-11-28 |
| 7 | 連続読み上げ・リピート再生 | ✅ | 2025-11-28 |
| 8 | 統計・グラフ表示 | ✅ | 2025-11-28 |
| 9 | 設定画面 | ✅ | 2025-11-28 |
| 10 | 最終調整・リリース | ✅ | 2025-11-28 |

**凡例**: ✅ 完了 / 🔄 進行中 / ⏳ 未着手

---

## ステップ詳細

### ステップ1: 基本構造 + スプレッドシート接続 ✅

**目標**: プロジェクトの基盤を構築し、スプレッドシートと接続

**実装内容**:
- [x] Code.gs: doGet(), getInitialData()
- [x] Index.html: 基本HTMLテンプレート
- [x] Style.html: 基本CSS（ローディング、ヘッダー、フッター）
- [x] Script.html: AppState, 初期化処理
- [x] スプレッドシート3シート初期化（Cards, Progress, Settings）
- [x] デバッグ情報表示

**成果物**:
- ローディング画面 → ホーム画面への遷移
- スプレッドシートからデータ取得・表示

---

### ステップ2: カードデータ表示（表/裏めくり） ✅

**目標**: フラッシュカードの表示とめくり機能

**実装内容**:
- [x] カード表示（表面/裏面）
- [x] 3Dフリップアニメーション（Y軸180度回転）
- [x] 動的フィールド対応（表示面、表示順による制御）
- [x] 回答ボタン（正解/不正解）
- [x] ナビゲーションボタン（前へ/次へ）
- [x] お気に入り・合格ボタン

**技術詳細**:
- CSS transform: rotateY(180deg)
- backface-visibility: hidden
- アニメーション時間: 0.6秒

---

### ステップ3: デッキ管理（ツリー表示・選択） ✅

**目標**: 階層構造のデッキ選択機能

**実装内容**:
- [x] デッキツリー構築（buildDeckTree）
- [x] ツリー形式での表示
- [x] 展開/折りたたみ機能
- [x] デッキ選択・ハイライト
- [x] 「すべてのデッキ」オプション
- [x] カード枚数表示

**技術詳細**:
- パス形式: `TOEIC/基礎/レベル1`
- 再帰的ツリー構築
- _children プロパティで子デッキ管理

---

### ステップ4: 学習モード・絞り込み機能 ✅

**目標**: 多様な学習条件で絞り込み

**実装内容**:
- [x] 学習設定画面
- [x] 学習モード（今日の復習/新規学習/全体復習）
- [x] 範囲指定（開始単語番号 + 学習単語数）
- [x] お気に入りフィルター
- [x] 未合格フィルター
- [x] シャッフル機能
- [x] 対象カード数プレビュー

**フィルター適用順序**:
1. デッキ → 2. ソート → 3. 範囲 → 4. モード → 5. お気に入り → 6. 未合格 → 7. シャッフル

---

### ステップ5: 正解/不正解記録・進捗管理 ✅

**目標**: 学習進捗の記録と間隔反復

**実装内容**:
- [x] 回答記録（正解/不正解カウント）
- [x] 連続正解数（streak）管理
- [x] 次回復習日計算（スペースドリピティション）
- [x] セッション内の回答修正対応
- [x] サーバーへの進捗保存
- [x] 視覚的フィードバック（正解=拡大、不正解=振動）

**間隔反復設定**:
| streak | 間隔 |
|--------|------|
| 1 | 1日 |
| 2 | 3日 |
| 3 | 7日 |
| 4 | 14日 |
| 5+ | 30日 |

---

### ステップ6: 読み上げ機能 ✅

**目標**: Web Speech APIによる音声読み上げ

**実装内容**:
- [x] 単体読み上げボタン
- [x] 言語自動判別（フィールド名/テキスト内容）
- [x] 読み上げ速度設定（英語/日本語別）
- [x] 読み上げ中UI表示（パルスアニメーション）
- [x] 停止機能

**言語判別ロジック**:
1. フィールド名に「英語」「English」→ en-US
2. フィールド名に「日本語」「読み」「例文」→ ja-JP
3. テキストにひらがな/カタカナ/漢字 → ja-JP
4. それ以外 → en-US

---

### ステップ7: 連続読み上げ・リピート再生 ✅

**目標**: ハンズフリー学習を実現

**実装内容**:
- [x] 連続再生モード（AutoPlay）
- [x] リピートモード
- [x] 表面→裏面の自動めくり
- [x] カード間の自動遷移
- [x] 待機時間設定対応
- [x] スライドアニメーション（左へスライドアウト、右からスライドイン）

**連続再生フロー**:
```
表面読み上げ → 待機 → めくる → 待機 → 裏面読み上げ → 待機 → 次のカード
```

**追加機能（後から実装）**:
- [x] 読み上げ速度設定のparseFloat変換
- [x] 待機時間0秒対応
- [x] 'interrupted'エラーの抑制
- [x] スライドアニメーション改善（次カードが後ろで待機、スライドイン不要に）

---

### ステップ8: 統計・グラフ表示 ✅

**目標**: 学習状況の可視化

**実装内容**:
- [x] 正解率計算・表示
- [x] 総正解数/総不正解数表示
- [x] 学習統計画面（設定画面内）
- [x] 詳細統計表示（総カード数、学習済み、合格、復習待ち）

**統計計算ロジック**:
- 正解率 = (総正解数 / (総正解数 + 総不正解数)) × 100

---

### ステップ9: 設定画面 ✅

**目標**: アプリ設定をUI上で変更可能に

**実装内容**:
- [x] 設定画面UI（ヘッダー、戻るボタン）
- [x] 学習モードの設定（読み上げ速度・待機時間）
- [x] 一覧読み上げの設定（速度・フィールド間・カード間）
- [x] 設定変更のリアルタイム保存（スプレッドシート連携）
- [x] 統計表示と設定表示を統合
- [x] 統計クリックでフィルター付き一覧表示に遷移

**設定画面表示項目**:
- 学習統計セクション（クリックで一覧画面へ）
- 学習モードの設定（英語速度、日本語速度、めくり後、カード間）
- 一覧読み上げの設定（英語速度、日本語速度、フィールド間、カード間）
- データ管理（スプレッドシートリンク）

---

### ステップ10: 最終調整・リリース ✅

**目標**: 品質向上とリリース準備

**実装内容**:
- [x] UI改善：ホーム画面ボタン整理（今日のテスト、学習モード、カード一覧）
- [x] 学習設定画面にデッキ選択を統合（ステップ削減）
- [x] カード一覧画面の実装（検索・フィルター機能）
- [x] カード編集画面の実装（フィールド編集・進捗表示）
- [x] スプレッドシートデータの閲覧・編集機能

**UI変更**:
- 「今日の復習」→「今日のテスト」
- 「デッキ選択」ボタンを削除、「学習モード」に統合
- 新規「カード一覧」ボタン追加

---

## 追加機能メモ

### 実装済みの追加機能

| 機能 | 説明 | 実装日 |
|------|------|--------|
| セッション回答修正 | 同カードへの再回答で前回を取り消し | 2025-11-28 |
| 回答ボタン常時表示 | 表面でも回答ボタンを表示 | 2025-11-28 |
| スライドアニメーション | カード切り替え時の滑らかな遷移 | 2025-11-28 |
| 一覧読み上げ設定 | フィールド間・カード間の待機時間設定 | 2025-11-29 |
| 設定リアルタイム保存 | スライダー変更でスプレッドシートに自動保存 | 2025-11-29 |
| スマホ対応強化 | レスポンシブデザイン、タッチ最適化 | 2025-11-29 |
| 統計クリック | 統計項目クリックでフィルター一覧表示 | 2025-11-29 |

### 検討中の機能

| 機能 | 優先度 | 備考 |
|------|:------:|------|
| 画像フィールド対応 | 中 | カードに画像を表示 |
| エクスポート/インポート | 低 | データのバックアップ |
| 複数ユーザー対応 | 低 | 共有機能 |
| オフライン対応 | 低 | PWA化 |

---

## 技術メモ

### 使用ライブラリ・API

| 名称 | 用途 |
|------|------|
| Google Apps Script | バックエンド |
| Google Spreadsheet | データベース |
| Web Speech API | 音声読み上げ |
| Material Icons | アイコン |
| Google Fonts (Noto Sans JP) | 日本語フォント |

### ブラウザ互換性

| ブラウザ | 対応状況 |
|---------|---------|
| Chrome | ✅ 推奨 |
| Safari | ✅ 対応 |
| Firefox | ✅ 対応 |
| Edge | ✅ 対応 |

### パフォーマンス目標

| 項目 | 目標値 |
|------|--------|
| 初期読み込み | 3秒以内 |
| カード切り替え | 即時（アニメーション除く） |
| 進捗保存 | 1秒以内 |

---

## 変更履歴

| 日付 | 内容 |
|------|------|
| 2025-11-28 | ステップ1〜7完了、スライドアニメーション追加 |
| 2025-11-28 | ステップ8-9完了、統計表示と設定画面を実装、コードリファクタリング |
| 2025-11-28 | ステップ10完了、UI改善・カード一覧/編集機能追加 |
| 2025-11-29 | 設定画面完成、リアルタイム保存対応、スマホ対応強化 |

---

*このドキュメントは開発の進捗管理用です。機能の詳細はSPECIFICATION.mdを参照してください。*
