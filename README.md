# GAS フラッシュカード

Google Apps Script (GAS) と HTML を活用した英単語学習用フラッシュカードアプリです。
SM-2アルゴリズムによる間隔反復学習システムを採用し、効率的な暗記学習をサポートします。

## 🎯 特徴

- **マルチフィールド対応**: 英語、日本語、読み、例文など複数フィールドを自由に設定
- **ツリー形式デッキ**: 階層構造で単語を整理・管理
- **SM-2アルゴリズム**: Anki風の本格的な間隔反復学習
- **難易度別評価**: 簡単/普通/難しいの3段階で回答精度を向上
- **音声読み上げ**: Web Speech API による自動読み上げ（継続モード対応）
- **連続再生モード**: ハンズフリーで学習可能
- **一覧読み上げ**: カード一覧から直接読み上げ（連続再生・リピート・言語フィルター）
- **弱点カード機能**: 間違いが多いカードを自動抽出して集中学習
- **キーボード/スワイプ操作**: 効率的なカード操作
- **学習統計**: セッション完了時に正解率・所要時間を視覚表示
- **フィルター機能**: 単語番号範囲、お気に入り、未合格で絞り込み
- **スライドアニメーション**: 滑らかなカード遷移

## 📦 ファイル構成

```
📁 HTML_GAS_flashcards
  ├── Code.gs              # GASサーバーサイドコード
  ├── Index.html           # メインHTML
  ├── Style.html           # CSS
  ├── Script.html          # クライアントサイドJavaScript
  ├── SPECIFICATION.md     # 詳細仕様書
  ├── README.md            # 本ファイル
  └── 開発ステップ計画.md   # 開発進捗
```

## 🚀 セットアップ手順

### 1. Google スプレッドシートの作成

1. [Google ドライブ](https://drive.google.com/) にアクセス
2. 「新規」→「Google スプレッドシート」→「空白のスプレッドシート」
3. スプレッドシートに名前を付ける（例：「フラッシュカード」）
4. **スプレッドシートのIDをメモ**
   ```
   URL: https://docs.google.com/spreadsheets/d/【ここがID】/edit
   ```

### 2. Google Apps Script プロジェクトの作成

1. スプレッドシートのメニュー「拡張機能」→「Apps Script」をクリック
2. プロジェクト名を「フラッシュカード」に変更

### 3. ファイルのコピー

Apps Script エディタで以下のファイルを作成・編集：

#### 3.1 Code.gs（既存ファイルを置き換え）
1. 既存の `Code.gs` の内容をすべて削除
2. 本プロジェクトの `Code.gs` の内容をコピー＆ペースト
3. **重要**: 下記の行を自分のスプレッドシートIDに変更
   ```javascript
   const SPREADSHEET_ID = 'あなたのスプレッドシートID';
   ```

#### 3.2 Index.html（新規作成）
1. 「+」ボタン →「HTML」をクリック
2. ファイル名を `Index` に設定（.html は自動追加）
3. 本プロジェクトの `Index.html` の内容をペースト

#### 3.3 Style.html（新規作成）
1. 「+」ボタン →「HTML」をクリック
2. ファイル名を `Style` に設定
3. 本プロジェクトの `Style.html` の内容をペースト

#### 3.4 Script.html（新規作成）
1. 「+」ボタン →「HTML」をクリック
2. ファイル名を `Script` に設定
3. 本プロジェクトの `Script.html` の内容をペースト

### 4. シートの初期化

1. Apps Script エディタで `initializeAllSheets` 関数を選択
2. 「実行」ボタンをクリック
3. 初回は権限の承認が必要：
   - 「権限を確認」→ Googleアカウント選択
   - 「詳細」→「（プロジェクト名）に移動」
   - 「許可」をクリック
4. スプレッドシートに2つのシート（Cards, Settings）が作成されます

### 5. デプロイ

1. 「デプロイ」→「新しいデプロイ」
2. 「種類の選択」で歯車アイコン →「ウェブアプリ」
3. 設定：
   - **説明**: 任意（例：「初期バージョン」）
   - **次のユーザーとして実行**: 「自分」
   - **アクセスできるユーザー**: 「自分のみ」
4. 「デプロイ」をクリック
5. 表示されたURLがアプリのURLです

### 6. 動作確認

1. デプロイURLにアクセス
2. 「デバッグ情報」セクションで確認：
   - ✅ 接続状態: ✓ 接続成功
   - ✅ カード数: 3（初期サンプル）
   - ✅ フィールド数: 7
   - ✅ デッキ数: 1

---

## 📝 使い方

### カードの追加・編集

1. Googleスプレッドシートの「Cards」シートを開く
2. 8行目以降にカードデータを入力
   - A列: ID（連番）
   - B〜G列: 進捗データ（初期値: 0, 空白, FALSE等）
   - H列以降: カスタムフィールド（デッキ、英語、日本語等）
3. アプリをリロードして反映

### フィールドのカスタマイズ

**Cardsシートの構造：**
- A〜G列: **固定列**（ID, 正解数, 不正解数, 連続正解, 次回復習日, お気に入り, 合格）
- H列以降: **カスタムフィールド**（自由に追加可能）

**1〜7行目で設定：**

| 行 | 内容 | 例 |
|----|------|-----|
| 1行目 | フィールド名 | 英語, 日本語, 読み... |
| 2行目 | 表示面 | 表, 裏, 非表示 |
| 3行目 | 表示順 | 1, 2, 3... |
| 4行目 | 読上順 | 1, 2, -（数字のみ有効） |
| 5行目 | 一覧位置 | 左, 右, 非表示 |
| 6行目 | 一覧表示順 | 1, 2, 3... |
| 7行目 | 一覧読上順 | 1, 2, -（数字のみ有効） |

### デッキの作成

「デッキ」列にパス形式で入力：
```
TOEIC
TOEIC/基礎
TOEIC/基礎/レベル1
```

### 学習の開始

1. ホーム画面で「デッキ選択」をタップ
2. 学習したいデッキを選択
3. 「学習設定へ」をタップ
4. モードや絞り込み条件を設定
5. 「学習開始」をタップ

### 連続再生モード

1. 学習画面で「▶」ボタンをタップ
2. 自動で読み上げ・めくり・次カード移動
3. 「↻」ボタンでリピートモードON
4. 「⏸」ボタンで停止

### キーボードショートカット

| キー | 動作 |
|------|------|
| ← | 裏面→表面、または前のカード |
| → | 表面→裏面、または次のカード |
| ↑ | 「簡単」で回答 |
| ↓ | 「難しい」で回答 |
| Space/Enter | カードをめくる |
| 1/2/3 | 難しい/普通/簡単で回答 |

### スワイプ操作（タッチデバイス）

| 操作 | 動作 |
|------|------|
| タップ | カードをめくる |
| 左/右スワイプ | 前後のカードに移動 |
| 上/下スワイプ | 簡単/難しいで回答 |

---

## ⚙️ 設定項目

### Settingsシートで変更可能

| 設定キー | デフォルト | 説明 |
|---------|-----------|------|
| speechRateEn | 1.0 | 学習画面の英語読み上げ速度 (0.5〜2.0) |
| speechRateJa | 1.0 | 学習画面の日本語読み上げ速度 (0.5〜2.0) |
| listSpeechRateEn | 1.0 | 一覧画面の英語読み上げ速度 (0.5〜2.0) |
| listSpeechRateJa | 1.0 | 一覧画面の日本語読み上げ速度 (0.5〜2.0) |
| waitTimeBetweenCards | 0 | カード間待機（秒） |
| waitTimeAfterFlip | 0 | めくり後待機（秒） |
| listWaitBetweenFields | 0 | 一覧フィールド間待機（秒） |
| listWaitBetweenCards | 0.3 | 一覧カード間待機（秒） |
| newCardsPerDay | 20 | 1日あたりの新規学習枚数 |
| easyMultiplier | 1.5 | 「簡単」評価時の間隔乗数 |
| normalMultiplier | 1.0 | 「普通」評価時の間隔乗数 |
| hardMultiplier | 0.5 | 「難しい」評価時の間隔乗数 |
| interval_1 | 1 | 1回正解後の復習間隔（日） |
| interval_2 | 3 | 2連続正解後の間隔（日） |
| interval_3 | 7 | 3連続正解後の間隔（日） |
| interval_4 | 14 | 4連続正解後の間隔（日） |
| interval_5 | 30 | 5連続以上正解後の間隔（日） |

---

## 🔧 トラブルシューティング

### 「スプレッドシートに接続できません」

- `Code.gs` の `SPREADSHEET_ID` が正しいか確認
- スプレッドシートへのアクセス権限があるか確認

### 画面が真っ白

- ブラウザの開発者ツール（F12）でエラー確認
- Apps Script の「実行」→「ログを確認」

### 読み上げが動作しない

- ブラウザがWeb Speech APIに対応しているか確認
- Chrome推奨

### 変更が反映されない

コードを修正した場合は再デプロイが必要：
1. 「デプロイ」→「デプロイを管理」
2. 編集（鉛筆アイコン）をクリック
3. バージョン: 「新バージョン」を選択
4. 「デプロイ」をクリック

---

## 📊 開発進捗

| ステップ | 内容 | 状態 |
|---------|------|------|
| 1 | 基本構造 + スプレッドシート接続 | ✅ 完了 |
| 2 | カードデータ表示（表/裏めくり） | ✅ 完了 |
| 3 | デッキ管理（ツリー表示・選択） | ✅ 完了 |
| 4 | 学習モード・絞り込み機能 | ✅ 完了 |
| 5 | 正解/不正解記録・進捗管理 | ✅ 完了 |
| 6 | 読み上げ機能 | ✅ 完了 |
| 7 | 連続読み上げ・リピート再生 | ✅ 完了 |
| 8 | SM-2アルゴリズム・難易度別評価 | ✅ 完了 |
| 9 | キーボード/スワイプ操作 | ✅ 完了 |
| 10 | 学習統計・弱点カード | ✅ 完了 |
| 11 | 設定画面 | ✅ 完了 |
| 12 | 学習履歴グラフ | ⏳ 未着手 |

---

## 📋 技術仕様

詳細な技術仕様は [SPECIFICATION.md](./SPECIFICATION.md) を参照してください。

---

## 📄 ライセンス

MIT License

---

## 🤝 コントリビューション

バグ報告や機能要望は Issue でお知らせください。

---

*最終更新: 2025年11月29日 (v2.0)*
